<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üß™ Test Webhook Caisse - URL Correcte</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
            min-height: 100vh;
            padding: 20px;
            margin: 0;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            padding: 40px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }
        h1 {
            text-align: center;
            color: #333;
            margin-bottom: 10px;
        }
        .url-display {
            background: #f8f9fa;
            border: 2px solid #28a745;
            border-radius: 8px;
            padding: 15px;
            margin: 20px 0;
            font-family: 'Courier New', monospace;
            word-break: break-all;
            color: #28a745;
            font-weight: bold;
        }
        button {
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            width: 100%;
            margin: 10px 0;
        }
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(40, 167, 69, 0.4);
        }
        .result {
            margin-top: 20px;
            padding: 20px;
            border-radius: 12px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
        }
        .result.success {
            background: #d4edda;
            border: 2px solid #28a745;
            color: #155724;
        }
        .result.error {
            background: #f8d7da;
            border: 2px solid #dc3545;
            color: #721c24;
        }
        .result.info {
            background: #d1ecf1;
            border: 2px solid #17a2b8;
            color: #0c5460;
        }
        .status {
            display: flex;
            align-items: center;
            gap: 10px;
            margin: 20px 0;
            padding: 15px;
            border-radius: 8px;
            background: #f8f9fa;
        }
        .status-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
        }
        .status-dot.red {
            background: #dc3545;
        }
        .status-dot.green {
            background: #28a745;
        }
        .status-dot.orange {
            background: #ffc107;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üß™ Test Webhook Caisse - URL Correcte</h1>
        
        <div class="status">
            <div class="status-dot orange"></div>
            <div>
                <strong>URL Identifi√©e :</strong><br>
                <span style="color: #666;">Webhook principal du workflow N8N</span>
            </div>
        </div>

        <div class="url-display">
            https://n8n.srv765811.hstgr.cloud/webhook/dc73da8d-bc62-45ef-8838-3f455861d29e
        </div>

        <div class="status">
            <div class="status-dot red"></div>
            <div>
                <strong>Status Actuel :</strong><br>
                <span style="color: #666;">Workflow N8N NON ACTIV√â</span>
            </div>
        </div>

        <button onclick="testWebhook()">üöÄ Tester le webhook</button>
        <button onclick="testWithCaisseData()">üõí Tester avec donn√©es de caisse</button>

        <div id="result"></div>
    </div>

    <script>
        const WEBHOOK_URL = 'https://n8n.srv765811.hstgr.cloud/webhook/dc73da8d-bc62-45ef-8838-3f455861d29e';

        async function testWebhook() {
            showResult('info', '‚è≥ Test en cours...', 'Test de base du webhook...');
            
            try {
                const response = await fetch(WEBHOOK_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        test: true,
                        source: 'test-webhook-correct',
                        timestamp: new Date().toISOString()
                    })
                });

                const text = await response.text();
                let data;
                try {
                    data = JSON.parse(text);
                } catch {
                    data = text;
                }

                if (response.ok) {
                    showResult('success', '‚úÖ Webhook fonctionne !', 
                        `Status: ${response.status} ${response.statusText}\n\n` +
                        `R√©ponse:\n${JSON.stringify(data, null, 2)}`);
                } else {
                    showResult('error', '‚ùå Erreur webhook', 
                        `Status: ${response.status} ${response.statusText}\n\n${text}`);
                }
            } catch (error) {
                showResult('error', '‚ùå Erreur r√©seau', 
                    `Impossible de contacter le webhook:\n\n${error.message}\n\n` +
                    `V√©rifiez que le workflow N8N est ACTIV√â !`);
            }
        }

        async function testWithCaisseData() {
            showResult('info', '‚è≥ Test avec donn√©es de caisse...', 'Simulation d\'une facture depuis la caisse...');
            
            const caisseData = {
                numero_facture: 'CAISSE-TEST-001',
                date_facture: new Date().toISOString().split('T')[0],
                nom_client: 'Client Test Caisse',
                email_client: 'test@myconfort.fr',
                telephone_client: '0600000000',
                montant_ttc: 180,
                montant_ht: 150,
                montant_tva: 30,
                payment_method: 'CB',
                vendeuse: 'Sylvie',
                vendorId: 'sylvie',
                produits: [
                    {
                        nom: 'Oreiller Douceur',
                        quantite: 2,
                        prix_ttc: 80,
                        remise: 0
                    },
                    {
                        nom: 'Couette 220x240',
                        quantite: 1,
                        prix_ttc: 300,
                        remise: 0
                    }
                ],
                source: 'caisse-myconfort-test'
            };

            try {
                const response = await fetch(WEBHOOK_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(caisseData)
                });

                const text = await response.text();
                let data;
                try {
                    data = JSON.parse(text);
                } catch {
                    data = text;
                }

                if (response.ok) {
                    showResult('success', '‚úÖ Facture envoy√©e avec succ√®s !', 
                        `Status: ${response.status} ${response.statusText}\n\n` +
                        `Facture: ${caisseData.numero_facture}\n` +
                        `Client: ${caisseData.nom_client}\n` +
                        `Montant: ${caisseData.montant_ttc}‚Ç¨\n\n` +
                        `R√©ponse N8N:\n${JSON.stringify(data, null, 2)}`);
                } else {
                    showResult('error', '‚ùå Erreur envoi facture', 
                        `Status: ${response.status} ${response.statusText}\n\n${text}`);
                }
            } catch (error) {
                showResult('error', '‚ùå Erreur r√©seau', 
                    `Impossible d'envoyer la facture:\n\n${error.message}\n\n` +
                    `V√©rifiez que le workflow N8N est ACTIV√â !`);
            }
        }

        function showResult(type, title, content) {
            const resultDiv = document.getElementById('result');
            resultDiv.className = `result ${type}`;
            resultDiv.innerHTML = `
                <strong>${title}</strong><br><br>
                <pre>${content}</pre>
            `;
        }

        // Auto-test au chargement
        window.addEventListener('load', () => {
            setTimeout(() => {
                showResult('info', 'üí° Pr√™t pour les tests', 
                    'URL webhook identifi√©e et configur√©e.\n\n' +
                    'IMPORTANT: Assurez-vous que le workflow N8N est ACTIV√â\n' +
                    'avant de lancer les tests.\n\n' +
                    'Cliquez sur les boutons ci-dessus pour tester.');
            }, 500);
        });
    </script>
</body>
</html>


